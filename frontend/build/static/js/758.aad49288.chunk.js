"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[758],{4932:(e,a,s)=>{s.d(a,{A:()=>i});s(9950);var r=s(3816),t=s(4414);const i=()=>{const e={animate:{rotate:360,transition:{repeat:1/0,duration:1,ease:"linear"}}};return(0,t.jsx)("div",{className:"flex items-center justify-center h-screen bg-background dark:bg-gray-900","aria-label":"Cargando",children:(0,t.jsx)(r.P.div,{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full",variants:e,animate:"animate",role:"status","aria-live":"polite"})})}},5758:(e,a,s)=>{s.r(a),s.d(a,{default:()=>h});var r=s(9950),t=s(5054),i=s(5082),o=s(6220),n=s(625),d=s(3816),l=s(688),c=s(4932),x=s(6174),g=s(4414);const h=()=>{const{user:e}=(0,t.A)(),a=(0,n.Zp)(),[s,h]=(0,r.useState)([]),[m,u]=(0,r.useState)([]),[y,p]=(0,r.useState)(""),[v,b]=(0,r.useState)(!0),[j,N]=(0,r.useState)(null);(0,r.useEffect)((()=>{(async()=>{try{if(!e)return void a("/login");const s=(0,o.P)((0,o.rJ)(i.db,"devices"),(0,o._M)("owner","==",e.uid)),r=(await(0,o.GG)(s)).docs.map((e=>({id:e.id,...e.data()})));if(h(r),r.length>0){const a=(0,o.P)((0,o.rJ)(i.db,"analytics"),(0,o._M)("userId","==",e.uid)),s=await(0,o.GG)(a);u(s.docs.map((e=>({id:e.id,...e.data()}))))}b(!1)}catch(j){console.error("Analytics: Data fetch error:",j),N("Error al cargar datos de an\xe1lisis"),x.oR.error("Error al cargar datos de an\xe1lisis"),b(!1)}})()}),[e,a]);const f=y?m.filter((e=>e.deviceId===y)):m,k=()=>f.reduce(((e,a)=>("turn_on"===a.action?e.onCount+=1:"turn_off"===a.action&&(e.offCount+=1),e)),{onCount:0,offCount:0});return v||!e?(0,g.jsx)(l.A,{children:(0,g.jsx)(c.A,{})}):(0,g.jsx)(l.A,{children:(0,g.jsxs)(d.P.div,{className:"max-w-6xl mx-auto p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[(0,g.jsx)("h1",{className:"text-4xl font-bold text-yellow-400 mb-8 text-center",children:"An\xe1lisis de Dispositivos - IoT Solutions"}),(0,g.jsxs)(d.P.div,{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8",initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},transition:{delay:.2,duration:.6},children:[j&&(0,g.jsx)(d.P.div,{className:"mb-6 p-4 bg-red-100 text-red-700 rounded-lg text-center",role:"alert","aria-live":"polite",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:j}),(0,g.jsxs)("div",{className:"mt-6",children:[(0,g.jsx)("h2",{className:"text-2xl font-semibold text-yellow-400 mb-4",children:"Seleccionar Dispositivo"}),(0,g.jsxs)("select",{value:y,onChange:e=>{return a=e.target.value,void p(a);var a},className:"w-full sm:w-1/2 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 transition-all duration-200","aria-label":"Seleccionar dispositivo para an\xe1lisis",children:[(0,g.jsx)("option",{value:"",children:"Todos los dispositivos"}),s.map((e=>(0,g.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,g.jsxs)("div",{className:"mt-8",children:[(0,g.jsx)("h2",{className:"text-2xl font-semibold text-yellow-400 mb-4",children:"Resumen de Uso"}),0===s.length?(0,g.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"No hay dispositivos registrados."}):0===f.length?(0,g.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"No hay datos de an\xe1lisis disponibles."}):(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)(d.P.div,{className:"p-6 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4},children:(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsxs)("div",{children:[(0,g.jsxs)("p",{className:"text-gray-600 dark:text-gray-300",children:["Veces encendido: ",(0,g.jsx)("span",{className:"font-semibold text-green-500",children:k().onCount})]}),(0,g.jsxs)("p",{className:"text-gray-600 dark:text-gray-300",children:["Veces apagado: ",(0,g.jsx)("span",{className:"font-semibold text-red-500",children:k().offCount})]})]}),(0,g.jsx)("svg",{className:"w-10 h-10 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,g.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 19v-2a2 2 0 00-2-2H5a2 2 0 00-2 2v2m12 0v-2a2 2 0 00-2-2h-2a2 2 0 00-2 2v2m-3-7V7a3 3 0 013-3h2a3 3 0 013 3v6m-6 0h6"})})]})}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"text-xl font-semibold text-yellow-400 mb-4",children:"Historial de Acciones"}),(0,g.jsx)("div",{className:"space-y-4",children:f.map((e=>{var a,r;return(0,g.jsxs)(d.P.div,{className:"p-6 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4},children:[(0,g.jsxs)("p",{className:"text-gray-600 dark:text-gray-300",children:["Dispositivo: ",(0,g.jsx)("span",{className:"font-medium",children:(null===(a=s.find((a=>a.id===e.deviceId)))||void 0===a?void 0:a.name)||"Desconocido"})]}),(0,g.jsxs)("p",{className:"text-gray-600 dark:text-gray-300",children:["Acci\xf3n: ",(0,g.jsx)("span",{className:"turn_on"===e.action?"text-green-500":"text-red-500",children:"turn_on"===e.action?"Encendido":"Apagado"})]}),(0,g.jsxs)("p",{className:"text-gray-600 dark:text-gray-300",children:["Fecha: ",new Date(1e3*(null===(r=e.timestamp)||void 0===r?void 0:r.seconds)).toLocaleString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]},e.id)}))})]})]})]}),(0,g.jsxs)("div",{className:"mt-8",children:[(0,g.jsx)("h2",{className:"text-2xl font-semibold text-yellow-400 mb-4",children:"Acciones"}),(0,g.jsxs)("ul",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,g.jsx)("li",{children:(0,g.jsx)(n.N_,{to:"/user/dashboard",className:"block p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200 text-center","aria-label":"Volver al dashboard",children:"Volver al Dashboard"})}),(0,g.jsx)("li",{children:(0,g.jsx)(n.N_,{to:"/devices/add",className:"block p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200 text-center","aria-label":"A\xf1adir dispositivo",children:"A\xf1adir Dispositivo"})}),(0,g.jsx)("li",{children:(0,g.jsx)(n.N_,{to:"/schedules",className:"block p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200 text-center","aria-label":"Ver horarios",children:"Ver Horarios"})})]})]})]})]})})}}}]);