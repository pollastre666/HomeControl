"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3469],{3469:(e,t,a)=>{a.r(t),a.d(t,{default:()=>A});var s=a(9950),r=a(5054),i=a(5082),l=a(6220),o=a(625),n=a(3816),d=a(1123),c=a(4932),m=a(6174),x=a(7205),g=a(9290),u=a(4729),h=a(2623),p=a(5556);function y(e,t){let{title:a,titleId:r,...i}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},i),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"}))}const b=s.forwardRef(y);function v(e,t){let{title:a,titleId:r,...i}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},i),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"}))}const w=s.forwardRef(v);function j(e,t){let{title:a,titleId:r,...i}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},i),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}const f=s.forwardRef(j);function N(e,t){let{title:a,titleId:r,...i}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},i),a?s.createElement("title",{id:r},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const k=s.forwardRef(N);var E=a(4414);const A=()=>{const{user:e}=(0,r.A)(),[t,a]=(0,s.useState)([]),[y,v]=(0,s.useState)([]),[j,N]=(0,s.useState)(!0),[A,C]=(0,s.useState)(!0),[S,L]=(0,s.useState)(null),[R,M]=(0,s.useState)(null),[$,D]=(0,s.useState)("all"),[I,P]=(0,s.useState)(localStorage.getItem("theme")||"light"),H=(0,s.useRef)([]),T={light:(0,E.jsx)(g.A,{className:"w-6 h-6 text-yellow-400"}),sensor:(0,E.jsx)(u.A,{className:"w-6 h-6 text-yellow-400"}),thermostat:(0,E.jsx)(h.A,{className:"w-6 h-6 text-yellow-400"}),camera:(0,E.jsx)(p.A,{className:"w-6 h-6 text-yellow-400"}),default:(0,E.jsx)(u.A,{className:"w-6 h-6 text-yellow-400"})},z=(0,s.useCallback)((async()=>{if(!e||!e.uid)return N(!1),void C(!1);N(!0),C(!0),M(null),L(null);try{const t=(0,l.P)((0,l.rJ)(i.db,"devices"),(0,l._M)("owner","==",e.uid)),s=(await(0,l.GG)(t)).docs.map((e=>({id:e.id,...e.data()})));s.forEach(((e,t)=>{const a=H.current[t];a&&a.status!==e.status&&a.id===e.id&&m.oR.info(`El dispositivo ${e.name||"Sin nombre"} cambi\xf3 a ${e.status?"Encendido":"Apagado"}`)})),a(s),H.current=s}catch(t){const e="permission-denied"===t.code?"No tienes permiso para ver los dispositivos":`Error al cargar dispositivos: ${t.message}`;M(e),m.oR.error(e)}finally{N(!1)}try{const t=(0,l.P)((0,l.rJ)(i.db,"purchases"),(0,l._M)("userId","==",e.uid)),a=(await(0,l.GG)(t)).docs.map((e=>{const t=e.data();return{id:e.id,...t,createdAt:t.createdAt&&"function"===typeof t.createdAt.toDate?t.createdAt:null}}));v(a)}catch(t){const e="permission-denied"===t.code?"No tienes permiso para ver las compras":`Error al cargar compras: ${t.message}`;L(e),m.oR.error(e)}finally{C(!1)}}),[null===e||void 0===e?void 0:e.uid]);(0,s.useEffect)((()=>{z()}),[z]);const B=(0,s.useCallback)((async(e,t)=>{try{await(0,l.mZ)((0,l.H9)(i.db,"devices",e),{status:!t}),m.oR.success("Estado del dispositivo actualizado"),a((a=>a.map((a=>a.id===e?{...a,status:!t}:a))))}catch(s){m.oR.error("Error al actualizar dispositivo")}}),[]),O=(0,s.useCallback)((async(t,s)=>{if(e){if(window.confirm(`\xbfEst\xe1s seguro de que quieres eliminar el dispositivo "${s||"Sin nombre"}"?`))try{await(0,l.kd)((0,l.H9)(i.db,"devices",t)),a((e=>e.filter((e=>e.id!==t)))),m.oR.success(`Dispositivo "${s||"Sin nombre"}" eliminado con \xe9xito`)}catch(r){console.error("Error removing device:",r),m.oR.error("Error al eliminar el dispositivo")}}else m.oR.error("Inicia sesi\xf3n para eliminar dispositivos.")}),[e]),W=(0,s.useCallback)((async(t,a)=>{if(e){if(window.confirm(`\xbfEst\xe1s seguro de que quieres eliminar la compra "${a||"Sin nombre"}"?`))try{await(0,l.kd)((0,l.H9)(i.db,"purchases",t)),v((e=>e.filter((e=>e.id!==t)))),m.oR.success(`Compra "${a||"Sin nombre"}" eliminada con \xe9xito`)}catch(s){console.error("Error removing purchase:",s),m.oR.error("Error al eliminar la compra")}}else m.oR.error("Inicia sesi\xf3n para eliminar compras.")}),[e]),q="all"===$?t:t.filter((e=>e.type===$)),G=t.length,V=t.filter((e=>e.status)).length,Z=t.sort(((e,t)=>{var a,s;return((null===(a=t.updatedAt)||void 0===a?void 0:a.toDate())||0)-((null===(s=e.updatedAt)||void 0===s?void 0:s.toDate())||0)}))[0];return j||!e?(0,E.jsx)(d.A,{children:(0,E.jsx)(c.A,{})}):(0,E.jsx)(d.A,{children:(0,E.jsxs)(n.P.div,{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8 py-8 font-sans",initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},children:[(0,E.jsx)("div",{className:"flex justify-end mb-4",children:(0,E.jsxs)(x.dO,{checked:"dark"===I,onChange:()=>{const e="light"===I?"dark":"light";P(e),localStorage.setItem("theme",e),document.documentElement.classList.toggle("dark","dark"===e)},className:"relative inline-flex items-center h-6 rounded-full w-11 bg-gray-200 dark:bg-gray-600",children:[(0,E.jsx)("span",{className:"sr-only",children:"Toggle theme"}),(0,E.jsx)("span",{className:("dark"===I?"translate-x-6":"translate-x-1")+" inline-block w-4 h-4 transform bg-white rounded-full transition"}),"dark"===I?(0,E.jsx)(b,{className:"w-4 h-4 absolute left-1 text-yellow-400"}):(0,E.jsx)(w,{className:"w-4 h-4 absolute right-1 text-yellow-400"})]})}),(0,E.jsxs)(n.P.div,{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[(0,E.jsx)("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200 mb-4",children:"Resumen"}),(0,E.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,E.jsxs)("div",{className:"p-4 bg-gray-100 dark:bg-gray-700 rounded-lg text-center",children:[(0,E.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Total Dispositivos"}),(0,E.jsx)("p",{className:"text-2xl font-bold text-yellow-400",children:G})]}),(0,E.jsxs)("div",{className:"p-4 bg-gray-100 dark:bg-gray-700 rounded-lg text-center",children:[(0,E.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Dispositivos Activos"}),(0,E.jsx)("p",{className:"text-2xl font-bold text-yellow-400",children:V})]}),(0,E.jsxs)("div",{className:"p-4 bg-gray-100 dark:bg-gray-700 rounded-lg text-center",children:[(0,E.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"\xdaltimo Modificado"}),(0,E.jsx)("p",{className:"text-sm font-medium text-yellow-400",children:Z?Z.name||"Sin nombre":"N/A"})]})]})]}),(0,E.jsxs)(n.P.div,{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[(0,E.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,E.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,E.jsx)("svg",{className:"w-8 h-8 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,E.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,E.jsxs)("div",{children:[(0,E.jsxs)("h1",{className:"text-2xl font-bold text-gray-800 dark:text-gray-200",children:["Bienvenido, ",e.name||e.username||"Usuario","!"]}),(0,E.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:["Rol: ",e.role]})]})]}),(0,E.jsx)("button",{onClick:z,className:"px-4 py-2 bg-yellow-400 text-gray-900 rounded-lg hover:bg-yellow-500 transition-colors",children:"Actualizar"})]}),(0,E.jsxs)("div",{className:"mt-6",children:[(0,E.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,E.jsx)("h2",{className:"text-xl font-semibold text-yellow-400",children:"Dispositivos"}),(0,E.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,E.jsx)(f,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),(0,E.jsxs)("select",{value:$,onChange:e=>D(e.target.value),className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg",children:[(0,E.jsx)("option",{value:"all",children:"Todos"}),(0,E.jsx)("option",{value:"light",children:"Luces"}),(0,E.jsx)("option",{value:"sensor",children:"Sensores"}),(0,E.jsx)("option",{value:"thermostat",children:"Termostatos"}),(0,E.jsx)("option",{value:"camera",children:"C\xe1maras"})]})]})]}),R?(0,E.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,E.jsx)("p",{className:"text-red-600 dark:text-red-400",children:R}),(0,E.jsx)("button",{onClick:z,className:"px-2 py-1 bg-yellow-400 text-gray-900 rounded hover:bg-yellow-500",children:"Reintentar"})]}):0===q.length?(0,E.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"No hay dispositivos para mostrar."}):(0,E.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:q.map((e=>(0,E.jsxs)(n.P.div,{className:"p-4 rounded-lg shadow-md transition-shadow duration-300 "+(e.status?"bg-green-50 dark:bg-green-900/50 border-2 border-green-500":"bg-red-50 dark:bg-red-900/50 border-2 border-red-500"),initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4},children:[(0,E.jsxs)("div",{className:"flex items-center justify-between",children:[(0,E.jsxs)("div",{className:"flex items-center space-x-3",children:[T[e.type]||T.default,(0,E.jsxs)("div",{children:[(0,E.jsx)("h3",{className:"font-medium text-gray-800 dark:text-gray-200",children:e.name||"Sin nombre"}),(0,E.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Tipo: ",e.type||"N/A"]})]})]}),(0,E.jsx)(x.dO,{checked:e.status,onChange:()=>B(e.id,e.status),className:(e.status?"bg-green-500":"bg-gray-200 dark:bg-gray-600")+" relative inline-flex items-center h-6 rounded-full w-11",children:(0,E.jsx)("span",{className:(e.status?"translate-x-6":"translate-x-1")+" inline-block w-4 h-4 transform bg-white rounded-full transition"})})]}),(0,E.jsxs)("div",{className:"mt-4 flex flex-col space-y-2 sm:flex-row sm:space-y-0 sm:space-x-2",children:[(0,E.jsx)(o.N_,{to:`/devices/${e.id}/control`,className:"w-full sm:w-auto px-4 py-2 bg-yellow-400 text-gray-900 font-medium rounded-lg hover:bg-yellow-500 transition-colors text-center",children:"Controlar"}),(0,E.jsxs)("button",{onClick:()=>O(e.id,e.name),className:"w-full sm:w-auto px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center","aria-label":`Eliminar dispositivo ${e.name||"Sin nombre"}`,children:[(0,E.jsx)(k,{className:"w-5 h-5 mr-1"})," Eliminar"]})]})]},e.id)))})]}),(0,E.jsxs)("div",{className:"mt-8",children:[(0,E.jsx)("h2",{className:"text-xl font-semibold text-yellow-400 mb-4",children:"Tus Compras"}),A?(0,E.jsx)(c.A,{}):S?(0,E.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,E.jsx)("p",{className:"text-red-600 dark:text-red-400",children:S}),(0,E.jsx)("button",{onClick:z,className:"px-2 py-1 bg-yellow-400 text-gray-900 rounded hover:bg-yellow-500",children:"Reintentar"})]}):0===y.length?(0,E.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"No hay compras registradas."}):(0,E.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:y.map((e=>{var t,a;return(0,E.jsx)(n.P.div,{className:"p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4},children:(0,E.jsxs)("div",{className:"flex items-center justify-between",children:[(0,E.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,E.jsx)("svg",{className:"w-6 h-6 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,E.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),(0,E.jsxs)("div",{children:[(0,E.jsx)("h3",{className:"font-medium text-gray-800 dark:text-gray-200",children:e.componentName||"Compra sin nombre"}),(0,E.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Monto: $",(null===(t=e.amount)||void 0===t?void 0:t.toFixed(2))||"0.00"," ",(null===(a=e.currency)||void 0===a?void 0:a.toUpperCase())||"USD"]}),(0,E.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Fecha:"," ",e.createdAt?e.createdAt.toDate().toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"Sin fecha"]})]})]}),(0,E.jsx)("button",{onClick:()=>W(e.id,e.componentName),className:"px-3 py-1 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors flex items-center","aria-label":`Eliminar compra ${e.componentName||"Sin nombre"}`,children:(0,E.jsx)(k,{className:"w-5 h-5"})})]})},e.id)}))})]}),(0,E.jsxs)("div",{className:"mt-8",children:[(0,E.jsx)("h2",{className:"text-xl font-semibold text-yellow-400 mb-4",children:"Acciones"}),(0,E.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{to:"/user/profile",label:"Editar Perfil"},{to:"/devices/add",label:"A\xf1adir Dispositivo"},{to:"/schedules",label:"Ver Horarios"},{to:"/Tareas",label:"Ver Tareas"}].map((e=>(0,E.jsx)(o.N_,{to:e.to,className:"p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-center",children:e.label},e.to)))})]})]})]})})}},4932:(e,t,a)=>{a.d(t,{A:()=>i});a(9950);var s=a(3816),r=a(4414);const i=()=>{const e={animate:{rotate:360,transition:{repeat:1/0,duration:1,ease:"linear"}}};return(0,r.jsx)("div",{className:"flex items-center justify-center h-screen bg-background dark:bg-gray-900","aria-label":"Cargando",children:(0,r.jsx)(s.P.div,{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full",variants:e,animate:"animate",role:"status","aria-live":"polite"})})}}}]);