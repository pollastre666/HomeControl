/*! For license information please see 9470.8fe58dc9.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[9470],{983:(e,r,a)=>{a.d(r,{A:()=>t});const t=(0,a(6230).A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},5330:(e,r,a)=>{a.r(r),a.d(r,{default:()=>N});var t=a(9950),o=a(3816),s=a(5054),i=a(625),n=a(5604),l=a(3291),c=a(6230);const d=(0,c.A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),m=(0,c.A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),u=(0,c.A)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),p=(0,c.A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var x=a(5082),h=a(6220),b=a(6174),g=a(4414);const y={hidden:{opacity:0,y:30},visible:{opacity:1,y:0,transition:{duration:.6,ease:"easeOut"}}},f={hidden:{opacity:0,x:-20},visible:{opacity:1,x:0,transition:{duration:.5,delay:.2}},focus:{scale:1.01,borderColor:"#d4af37",transition:{duration:.3}},error:{borderColor:"#e11d48",transition:{duration:.3}},success:{borderColor:"#10b981",transition:{duration:.3}}},v={hover:{scale:1.05,boxShadow:"0px 8px 20px rgba(212, 175, 55, 0.3)",transition:{duration:.3}},tap:{scale:.98,transition:{duration:.1}}},w=e=>{let{component:r,onClose:a,user:s}=e;const i=(0,n.useStripe)(),c=(0,n.useElements)(),[w,j]=(0,t.useState)(null),[N,k]=(0,t.useState)(!1),[C,P]=(0,t.useState)(!1),[S,z]=(0,t.useState)(""),[A,E]=(0,t.useState)(""),$=(0,t.useCallback)((async e=>{if(e.preventDefault(),console.log("Payment submission started. User:",null===s||void 0===s?void 0:s.uid,"Stripe:",!!i,"Elements:",!!c),k(!0),j(null),!i||!c)return j("Stripe no est\xe1 inicializado. Por favor, recarga la p\xe1gina."),k(!1),void console.error("Stripe or Elements not initialized");if(!s)return j("Debes estar autenticado para realizar la compra. Inicia sesi\xf3n."),k(!1),void console.error("User not authenticated");if(!S.trim())return E("El nombre del titular es obligatorio."),k(!1),void console.error("Holder name is empty");const t=c.getElement(n.CardElement);if(!t)return j("No se pudo acceder al elemento de la tarjeta."),k(!1),void console.error("CardElement not found");if(!C)return j("Por favor, completa los detalles de la tarjeta."),k(!1),void console.error("Card details incomplete");try{console.log("Requesting payment intent from server at http://localhost:4242/create-payment-intent...");const e=await fetch("http://localhost:4242/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:Math.round(100*r.price),currency:"usd"})});if(!e.ok){const r=await e.text();throw console.error("Server response error:",r),new Error(`No se pudo conectar con el servidor: ${e.status} - ${r}`)}const{clientSecret:n}=await e.json();console.log("Payment intent client secret received:",n),console.log("Confirming card payment with Stripe...");const l=await i.confirmCardPayment(n,{payment_method:{card:t,billing_details:{name:S}}});if(l.error)j(`Error al procesar el pago: ${l.error.message}`),console.error("Payment error:",l.error);else if("succeeded"===l.paymentIntent.status){console.log("Payment succeeded:",l.paymentIntent);try{await(0,h.gS)((0,h.rJ)(x.db,"purchases"),{userId:s.uid,componentId:r.id,componentName:r.name,amount:r.price,currency:"usd",paymentIntentId:l.paymentIntent.id,createdAt:(0,h.O5)()}),console.log("Purchase saved to Firestore"),b.oR.success("\xa1Compra guardada exitosamente!")}catch(o){console.error("Error saving purchase to Firestore:",o),b.oR.error("Pago exitoso, pero no se pudo guardar la compra. Contacta al soporte.")}alert("\xa1Pago exitoso! Gracias por tu compra."),a()}}catch(l){l.message.includes("Failed to fetch")?j("No se pudo conectar con el servidor de pagos. Aseg\xfarate de que el servidor est\xe9 funcionando y vuelve a intentarlo."):j(`Error al procesar el pago: ${l.message}`),console.error("Payment processing error:",l)}finally{k(!1)}}),[i,c,s,S,r,a,C]);return(0,g.jsxs)(o.P.div,{className:"relative p-8 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 rounded-2xl shadow-2xl max-w-lg w-full mx-auto overflow-hidden",variants:y,initial:"hidden",animate:"visible",children:[(0,g.jsx)("div",{className:"absolute inset-0 opacity-20 pointer-events-none",children:(0,g.jsxs)("svg",{className:"w-full h-full",children:[(0,g.jsx)("defs",{children:(0,g.jsxs)("filter",{id:"glow",children:[(0,g.jsx)("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"blur"}),(0,g.jsxs)("feMerge",{children:[(0,g.jsx)("feMergeNode",{in:"blur"}),(0,g.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})}),[...Array(10)].map(((e,r)=>(0,g.jsx)("circle",{cx:100*Math.random()+"%",cy:100*Math.random()+"%",r:"2",fill:"#d4af37",filter:"url(#glow)",className:"animate-pulse"},r)))]})}),(0,g.jsxs)("form",{onSubmit:$,className:"relative z-10 space-y-8",children:[(0,g.jsxs)("div",{className:"text-center",children:[(0,g.jsx)("h3",{className:"text-3xl font-serif font-semibold text-gray-100 tracking-wide",children:"Finalizar Compra"}),(0,g.jsxs)("p",{className:"text-sm text-gray-400 mt-2",children:["Completa tu compra de ",(0,g.jsx)("span",{className:"text-amber-400",children:r.name})," de forma segura"]}),(0,g.jsxs)("p",{className:"text-lg font-bold text-amber-400 mt-1",children:["Total: $",r.price.toFixed(2)," USD"]})]}),(0,g.jsxs)(o.P.div,{className:"relative p-4 border-2 border-gray-700 rounded-lg bg-gray-800/50 backdrop-blur-sm",variants:f,initial:"hidden",animate:"visible",whileFocus:"focus",whileHover:"focus",custom:0,children:[(0,g.jsxs)("label",{className:"flex items-center text-gray-300 text-sm font-medium mb-2",children:[(0,g.jsx)(d,{size:16,className:"mr-2 text-amber-400"}),"Nombre y apellido del titular"]}),(0,g.jsx)("input",{type:"text",value:S,onChange:e=>{const r=e.target.value;z(r),r.trim()?E(""):E("El nombre del titular es obligatorio."),console.log("Holder name updated:",r)},className:"w-full p-3 bg-transparent border-0 text-gray-100 focus:ring-0 focus:outline-none placeholder-gray-500",placeholder:"Tu nombre completo","aria-label":"Nombre del titular"}),(0,g.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-amber-400 to-transparent transition-all duration-300"}),(0,g.jsx)(l.N,{children:A&&(0,g.jsxs)(o.P.div,{className:"flex items-center text-rose-600 text-sm mt-2",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:[(0,g.jsx)(m,{size:16,className:"mr-1"}),A]})})]}),(0,g.jsxs)(o.P.div,{className:"relative p-4 border-2 border-gray-700 rounded-lg bg-gray-800/50 backdrop-blur-sm",variants:f,initial:"hidden",animate:"visible",whileFocus:"focus",whileHover:"focus",custom:1,children:[(0,g.jsxs)("label",{className:"flex items-center text-gray-300 text-sm font-medium mb-2",children:[(0,g.jsx)(u,{size:16,className:"mr-2 text-amber-400"}),"Detalles de la tarjeta"]}),(0,g.jsx)(n.CardElement,{options:{style:{base:{fontSize:"16px",color:"#e5e7eb","::placeholder":{color:"#6b7280"},fontFamily:'"Inter", sans-serif'},invalid:{color:"#e11d48"}},hidePostalCode:!0},onChange:e=>{var r;P(e.complete),e.error?j(e.error.message):j(null),console.log("Card change detected. Complete:",e.complete,"Error:",null===(r=e.error)||void 0===r?void 0:r.message)},className:"w-full p-3 bg-transparent","aria-label":"Detalles de la tarjeta"}),(0,g.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-amber-400 to-transparent transition-all duration-300"}),(0,g.jsxs)(l.N,{children:[w&&(0,g.jsxs)(o.P.div,{className:"flex items-center text-rose-600 text-sm mt-2",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:[(0,g.jsx)(m,{size:16,className:"mr-1"}),w]}),C&&!w&&(0,g.jsxs)(o.P.div,{className:"flex items-center text-emerald-500 text-sm mt-2",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:[(0,g.jsx)(p,{size:16,className:"mr-1"}),"Datos v\xe1lidos"]})]})]}),(0,g.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,g.jsxs)(o.P.button,{type:"submit",disabled:!i||!C||!!A||N||!s,variants:v,whileHover:"hover",whileTap:"tap",className:"relative w-full sm:w-auto bg-gradient-to-r from-amber-500 to-amber-700 text-white px-6 py-3 rounded-lg font-semibold text-lg shadow-lg overflow-hidden group disabled:opacity-50 disabled:cursor-not-allowed","aria-label":`Pagar ${r.price.toFixed(2)} USD`,children:[(0,g.jsx)("span",{className:"absolute inset-0 bg-gradient-to-r from-amber-400 to-amber-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),(0,g.jsx)("span",{className:"relative z-10",children:N?"Procesando...":`Pagar $${r.price.toFixed(2)}`})]}),(0,g.jsx)(o.P.button,{onClick:a,variants:v,whileHover:"hover",whileTap:"tap",className:"w-full sm:w-auto bg-gray-700 text-gray-300 px-6 py-3 rounded-lg font-semibold text-lg hover:bg-gray-600 transition-colors duration-300","aria-label":"Cancelar compra",children:"Cancelar"})]}),(0,g.jsx)("p",{className:"text-center text-gray-500 text-xs",children:"Usa la tarjeta de prueba: 4242 4242 4242 4242 (fecha futura, CVV cualquiera)"})]}),(0,g.jsx)("style",{children:"\n          @keyframes pulse {\n            0%, 100% { opacity: 0.3; }\n            50% { opacity: 0.6; }\n          }\n          .animate-pulse {\n            animation: pulse 3s ease-in-out infinite;\n          }\n        "})]})},j={hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1,transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0,scale:.9,transition:{duration:.3}}},N=e=>{let{isOpen:r,onClose:a,component:t}=e;const{user:n}=(0,s.A)();return console.log("CheckoutModal: User:",n),r?n?(0,g.jsxs)(o.P.div,{className:"fixed inset-0 bg-black bg-opacity-90 z-[1000] flex items-center justify-center p-6",initial:"hidden",animate:"visible",exit:"exit",variants:j,onClick:a,children:[(0,g.jsx)("div",{className:"fixed inset-0 bg-transparent pointer-events-none"}),(0,g.jsx)(o.P.div,{className:"relative bg-white/95 dark:bg-gray-800/95 rounded-2xl shadow-2xl max-w-lg w-full p-0 overflow-hidden border border-amber-200/40 dark:border-amber-900/40 backdrop-blur-md",onClick:e=>e.stopPropagation(),children:(0,g.jsx)(w,{component:t,onClose:a,user:n})})]}):(0,g.jsx)(o.P.div,{className:"fixed inset-0 bg-black bg-opacity-90 z-[1000] flex items-center justify-center p-6",initial:"hidden",animate:"visible",exit:"exit",variants:j,children:(0,g.jsxs)("div",{className:"bg-white/95 dark:bg-gray-800/95 rounded-2xl p-6 sm:p-8 shadow-2xl max-w-md w-full text-center border border-amber-200/40 dark:border-amber-900/40 backdrop-blur-md",children:[(0,g.jsx)("h3",{className:"text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4",children:"Autenticaci\xf3n Requerida"}),(0,g.jsxs)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Debes iniciar sesi\xf3n para realizar una compra. Por favor,"," ",(0,g.jsx)(i.N_,{to:"/login",className:"text-amber-600 dark:text-amber-400 hover:underline font-medium",onClick:a,children:"inicia sesi\xf3n"})," ","o reg\xedstrate."]}),(0,g.jsx)(o.P.button,{onClick:a,className:"px-6 py-2 bg-gradient-to-r from-amber-600 to-amber-700 dark:from-amber-500 dark:to-amber-600 text-white rounded-lg hover:from-amber-700 hover:to-amber-800 transition-all duration-300 shadow-md",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Cerrar"})]})}):null}},6230:(e,r,a)=>{a.d(r,{A:()=>c});var t=a(9950);const o=e=>{const r=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,((e,r,a)=>a?a.toUpperCase():r.toLowerCase())))(e);return r.charAt(0).toUpperCase()+r.slice(1)},s=function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return r.filter(((e,r,a)=>Boolean(e)&&""!==e.trim()&&a.indexOf(e)===r)).join(" ").trim()},i=e=>{for(const r in e)if(r.startsWith("aria-")||"role"===r||"title"===r)return!0};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const l=(0,t.forwardRef)(((e,r)=>{let{color:a="currentColor",size:o=24,strokeWidth:l=2,absoluteStrokeWidth:c,className:d="",children:m,iconNode:u,...p}=e;return(0,t.createElement)("svg",{ref:r,...n,width:o,height:o,stroke:a,strokeWidth:c?24*Number(l)/Number(o):l,className:s("lucide",d),...!m&&!i(p)&&{"aria-hidden":"true"},...p},[...u.map((e=>{let[r,a]=e;return(0,t.createElement)(r,a)})),...Array.isArray(m)?m:[m]])})),c=(e,r)=>{const a=(0,t.forwardRef)(((a,i)=>{let{className:n,...c}=a;return(0,t.createElement)(l,{ref:i,iconNode:r,className:s(`lucide-${d=o(e),d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,n),...c});var d}));return a.displayName=o(e),a}}}]);