"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[33],{4932:(e,a,r)=>{r.d(a,{A:()=>i});r(9950);var s=r(3816),t=r(4414);const i=()=>{const e={animate:{rotate:360,transition:{repeat:1/0,duration:1,ease:"linear"}}};return(0,t.jsx)("div",{className:"flex items-center justify-center h-screen bg-background dark:bg-gray-900","aria-label":"Cargando",children:(0,t.jsx)(s.P.div,{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full",variants:e,animate:"animate",role:"status","aria-live":"polite"})})}},5033:(e,a,r)=>{r.r(a),r.d(a,{default:()=>h});var s=r(9950),t=r(5054),i=r(5082),o=r(6220),l=r(625),d=r(3816),n=r(688),c=r(4932),g=r(6174),x=r(4414);const h=()=>{const{user:e}=(0,t.A)(),[a,r]=(0,s.useState)([]),[h,m]=(0,s.useState)([]),[u,y]=(0,s.useState)(!0),[p,b]=(0,s.useState)(!0),[v,j]=(0,s.useState)(null),[N,w]=(0,s.useState)(null),k=(0,s.useCallback)((async()=>{if(!e||!e.uid)return console.log("UserDashboard: No user or user.uid, skipping fetch"),y(!1),void b(!1);console.log("UserDashboard: Fetching data for user:",e.uid),y(!0),b(!0),w(null),j(null);try{const a=(0,o.P)((0,o.rJ)(i.db,"devices"),(0,o._M)("owner","==",e.uid)),s=(await(0,o.GG)(a)).docs.map((e=>({id:e.id,...e.data()})));r(s),console.log("UserDashboard: Devices fetched:",s.length)}catch(a){console.error("UserDashboard: Device fetch error:",a);const e="permission-denied"===a.code?"No tienes permiso para ver los dispositivos":`Error al cargar dispositivos: ${a.message}`;w(e),g.oR.error(e)}finally{y(!1)}try{const a=(0,o.P)((0,o.rJ)(i.db,"purchases"),(0,o._M)("userId","==",e.uid)),r=(await(0,o.GG)(a)).docs.map((e=>{const a=e.data();return{id:e.id,...a,createdAt:a.createdAt&&"function"===typeof a.createdAt.toDate?a.createdAt:null}}));m(r),console.log("UserDashboard: Purchases fetched:",r.length)}catch(a){console.error("UserDashboard: Purchase fetch error:",a);const e="permission-denied"===a.code?"No tienes permiso para ver las compras":`Error al cargar compras: ${a.message}`;j(e),g.oR.error(e)}finally{b(!1)}}),[null===e||void 0===e?void 0:e.uid]);(0,s.useEffect)((()=>{k()}),[k]);const f=(0,s.useCallback)((async(e,a)=>{try{await(0,o.mZ)((0,o.H9)(i.db,"devices",e),{status:!a}),g.oR.success("Estado del dispositivo actualizado"),k()}catch(r){console.error("UserDashboard: Device toggle error:",r),g.oR.error("Error al actualizar dispositivo")}}),[k]);return u||!e?(0,x.jsx)(n.A,{children:(0,x.jsx)(c.A,{})}):(0,x.jsx)(n.A,{children:(0,x.jsxs)(d.P.div,{className:"max-w-6xl mx-auto p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[(0,x.jsx)("h1",{className:"text-4xl font-bold text-yellow-400 mb-8",children:"Dashboard de Usuario - IoT Solutions"}),(0,x.jsxs)(d.P.div,{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8",initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},transition:{delay:.2,duration:.6},children:[(0,x.jsxs)("div",{className:"flex items-center space-x-4 mb-6",children:[(0,x.jsx)("svg",{className:"w-10 h-10 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,x.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,x.jsxs)("div",{children:[(0,x.jsxs)("p",{className:"text-2xl font-semibold text-gray-800 dark:text-gray-200",children:["Bienvenido, ",e.name||e.username||"Usuario","!"]}),(0,x.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:["Rol: ",e.role]})]})]}),(0,x.jsxs)("div",{className:"mt-8",children:[(0,x.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,x.jsx)("h2",{className:"text-2xl font-semibold text-yellow-400",children:"Dispositivos"}),(0,x.jsx)("button",{onClick:k,className:"px-4 py-2 bg-yellow-400 text-gray-900 rounded-lg hover:bg-yellow-500",children:"Actualizar"})]}),N?(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsx)("p",{className:"text-red-600 dark:text-red-400",children:N}),(0,x.jsx)("button",{onClick:k,className:"px-2 py-1 bg-yellow-400 text-gray-900 rounded hover:bg-yellow-500",children:"Reintentar"})]}):0===a.length?(0,x.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"No hay dispositivos registrados."}):(0,x.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map((e=>(0,x.jsxs)(d.P.div,{className:"p-6 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4},children:[(0,x.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,x.jsx)("svg",{className:"w-8 h-8 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,x.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 1v2m0 18v2m-9-11h2m18 0h-2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12a11 11 0 012.12-6.56M22 12a11 11 0 01-2.12 6.56M6.66 6.66A7.96 7.96 0 014.1 12a7.96 7.96 0 012.56 5.34m12.68 0A7.96 7.96 0 0119.9 12a7.96 7.96 0 01-2.56-5.34"})}),(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"font-medium text-gray-800 dark:text-gray-200",children:e.name||"Sin nombre"}),(0,x.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:["Estado:"," ",(0,x.jsx)("span",{className:e.status?"text-green-500":"text-red-500",children:e.status?"Encendido":"Apagado"})]}),(0,x.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:["Tipo: ",e.type||"N/A"]})]})]}),(0,x.jsxs)("div",{className:"mt-4 space-x-3",children:[(0,x.jsx)(d.P.button,{onClick:()=>f(e.id,e.status),className:"px-4 py-2 rounded-lg font-medium transition-colors duration-200 "+(e.status?"bg-red-500 text-white hover:bg-red-600":"bg-green-500 text-white hover:bg-green-600"),whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":`Cambiar estado de ${e.name||"dispositivo"}`,children:e.status?"Apagar":"Encender"}),(0,x.jsx)(l.N_,{to:`/devices/${e.id}/control`,className:"px-4 py-2 bg-yellow-400 text-gray-900 font-medium rounded-lg hover:bg-yellow-500 transition-colors duration-200","aria-label":`Controlar ${e.name||"dispositivo"}`,children:"Controlar"})]})]},e.id)))})]}),(0,x.jsxs)("div",{className:"mt-8",children:[(0,x.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,x.jsx)("h2",{className:"text-2xl font-semibold text-yellow-400",children:"Tus Compras"}),(0,x.jsx)("button",{onClick:k,className:"px-4 py-2 bg-yellow-400 text-gray-900 rounded-lg hover:bg-yellow-500",children:"Actualizar"})]}),p?(0,x.jsx)(c.A,{}):v?(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsx)("p",{className:"text-red-600 dark:text-red-400",children:v}),(0,x.jsx)("button",{onClick:k,className:"px-2 py-1 bg-yellow-400 text-gray-900 rounded hover:bg-yellow-500",children:"Reintentar"})]}):0===h.length?(0,x.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"No hay compras registradas."}):(0,x.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map((e=>{var a,r,s;return(0,x.jsx)(d.P.div,{className:"p-6 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4},children:(0,x.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,x.jsx)("svg",{className:"w-8 h-8 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,x.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"font-medium text-gray-800 dark:text-gray-200",children:e.componentName||"Compra sin nombre"}),(0,x.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:["Monto: $",(null===(a=e.amount)||void 0===a?void 0:a.toFixed(2))||"0.00"," ",(null===(r=e.currency)||void 0===r?void 0:r.toUpperCase())||"USD"]}),(0,x.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:["Fecha:"," ",e.createdAt?e.createdAt.toDate().toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"Sin fecha"]}),(0,x.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:["ID de Pago: ",(null===(s=e.paymentIntentId)||void 0===s?void 0:s.slice(0,8))||"N/A","..."]})]})]})},e.id)}))})]}),(0,x.jsxs)("div",{className:"mt-8",children:[(0,x.jsx)("h2",{className:"text-2xl font-semibold text-yellow-400 mb-4",children:"Acciones"}),(0,x.jsxs)("ul",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,x.jsx)("li",{children:(0,x.jsx)(l.N_,{to:"/user/profile",className:"block p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200","aria-label":"Editar perfil",children:"Editar Perfil"})}),(0,x.jsx)("li",{children:(0,x.jsx)(l.N_,{to:"/devices/add",className:"block p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200","aria-label":"A\xf1adir dispositivo",children:"A\xf1adir Dispositivo"})}),(0,x.jsx)("li",{children:(0,x.jsx)(l.N_,{to:"/schedules",className:"block p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200","aria-label":"Ver horarios",children:"Ver Horarios"})}),(0,x.jsx)("li",{children:(0,x.jsx)(l.N_,{to:"/Analytics",className:"block p-4 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200","aria-label":"Ver an\xe1lisis",children:"Ver An\xe1lisis"})})]})]})]})]})})}}}]);