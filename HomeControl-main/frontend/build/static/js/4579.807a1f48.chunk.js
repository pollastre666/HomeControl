"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[4579],{4579:(e,a,r)=>{r.r(a),r.d(a,{default:()=>h});var t=r(9950),o=r(5054),i=r(3816),l=r(3291),s=r(625),n=r(1123),d=r(4932),c=r(6174),m=r(8312),u=r(4414);const g=e=>{let{user:a,onAvatarChange:r,isEditing:o,toggleEdit:l}=e;const[s,n]=(0,t.useState)(a.avatar||`https://www.gravatar.com/avatar/${a.email}?d=identicon`),[d,c]=(0,t.useState)(null);return(0,u.jsx)(i.P.div,{className:"shadow-lg rounded-lg p-6 h-fit bg-white",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.6},role:"region","aria-label":"Resumen del perfil",children:(0,u.jsxs)("div",{className:"flex flex-col items-center",children:[(0,u.jsx)("div",{className:"relative w-24 h-24 mb-4",children:o?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("label",{htmlFor:"avatar-upload",className:"cursor-pointer",children:[(0,u.jsx)("img",{src:s,alt:"Foto de perfil",className:"w-full h-full rounded-full object-cover border-2 border-yellow-400","aria-label":"Imagen de perfil del usuario"}),(0,u.jsx)("div",{className:"absolute bottom-0 right-0 bg-yellow-400 p-2 rounded-full hover:bg-yellow-500",children:(0,u.jsx)("svg",{className:"w-4 h-4 text-gray-900",fill:"currentColor",viewBox:"0 0 20 20",children:(0,u.jsx)("path",{d:"M13.5 3H7a2 2 0 00-2 2v10a2 2 0 002 2h6.5l3-3.5V5a2 2 0 00-2-2z"})})})]}),(0,u.jsx)("input",{id:"avatar-upload",type:"file",accept:"image/*",className:"hidden",onChange:e=>{const a=e.target.files[0];if(a){if(a.size>2097152)return void c("La imagen debe ser menor a 2MB");const e=new FileReader;e.onload=()=>{n(e.result),r(a,e.result)},e.readAsDataURL(a),c(null)}},"aria-describedby":"avatar-error","aria-invalid":!!d}),d&&(0,u.jsx)("p",{id:"avatar-error",className:"text-red-600 text-sm mt-2",role:"alert",children:d})]}):(0,u.jsx)("img",{src:s,alt:"Foto de perfil",className:"w-full h-full rounded-full object-cover","aria-label":"Imagen de perfil del usuario"})}),(0,u.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:a.name||"Usuario"}),(0,u.jsx)("p",{className:"text-gray-600",children:a.email}),(0,u.jsx)("button",{onClick:l,className:"mt-4 px-4 py-2 bg-yellow-400 text-gray-900 font-medium rounded-lg hover:bg-yellow-500 transition-colors","aria-label":o?"Cancelar edici\xf3n":"Editar perfil",children:o?"Cancelar":"Editar"})]})})},x=e=>{let{formData:a,setFormData:r,user:t,onSubmit:o,errors:s,isEditing:n,toggleEdit:d,onDraftSave:c}=e;const m=e=>{const{name:t,value:o}=e.target;r((e=>({...e,[t]:o}))),c({...a,[t]:o})};return(0,u.jsxs)(i.P.div,{className:"shadow-lg rounded-lg p-6 bg-white",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.6},role:"form","aria-label":"Formulario de edici\xf3n de perfil",children:[(0,u.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,u.jsx)("h2",{className:"text-2xl font-semibold text-yellow-400",children:"Editar Perfil"}),(0,u.jsx)("button",{onClick:d,className:"px-4 py-2 bg-yellow-400 text-gray-900 rounded-lg hover:bg-yellow-500","aria-label":n?"Cancelar edici\xf3n":"Editar perfil",children:n?"Cancelar":"Editar"})]}),(0,u.jsx)(l.N,{children:n?(0,u.jsxs)(i.P.form,{onSubmit:o,className:"space-y-6",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[(0,u.jsxs)("div",{className:"p-4 rounded-lg bg-gray-50 border border-gray-300",children:[(0,u.jsx)("h3",{className:"text-lg font-medium mb-4 text-gray-900",children:"Informaci\xf3n Personal"}),(0,u.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Nombre completo"}),(0,u.jsx)("input",{type:"text",id:"name",name:"name",value:a.name,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 bg-gray-50","aria-required":"true","aria-describedby":"name-error","aria-invalid":!!s.name}),s.name&&(0,u.jsx)("p",{id:"name-error",className:"text-red-600 text-sm mt-1",role:"alert",children:s.name})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Tel\xe9fono"}),(0,u.jsx)("input",{type:"tel",id:"phone",name:"phone",value:a.phone,onChange:m,className:"mt-1 block-height w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 bg-gray-50","aria-describedby":"phone-error","aria-invalid":!!s.phone}),s.phone&&(0,u.jsx)("p",{id:"phone-error",className:"text-red-600 text-sm mt-1",role:"alert",children:s.phone})]})]})]}),(0,u.jsxs)("div",{className:"p-4 rounded-lg bg-gray-50 border border-gray-300",children:[(0,u.jsx)("h3",{className:"text-lg font-medium mb-4 text-gray-900",children:"Direcci\xf3n"}),(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,u.jsxs)("div",{className:"md:col-span-2",children:[(0,u.jsx)("label",{htmlFor:"street",className:"block text-sm font-medium text-gray-700",children:"Direcci\xf3n"}),(0,u.jsx)("input",{type:"text",id:"street",name:"street",value:a.street,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 bg-gray-50"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700",children:"Ciudad"}),(0,u.jsx)("input",{type:"text",id:"city",name:"city",value:a.city,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 bg-gray-50"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"postalCode",className:"block text-sm font-medium text-gray-700",children:"C\xf3digo postal"}),(0,u.jsx)("input",{type:"text",id:"postalCode",name:"postalCode",value:a.postalCode,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 bg-gray-50","aria-describedby":"postalCode-error","aria-invalid":!!s.postalCode}),s.postalCode&&(0,u.jsx)("p",{id:"postalCode-error",className:"text-red-600 text-sm mt-1",role:"alert",children:s.postalCode})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700",children:"Pa\xeds"}),(0,u.jsx)("input",{type:"text",id:"country",name:"country",value:a.country,onChange:m,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 bg-gray-50"})]})]})]}),(0,u.jsx)("div",{className:"flex justify-end",children:(0,u.jsx)(i.P.button,{type:"submit",className:"px-6 py-2 bg-yellow-400 text-gray-900 font-semibold rounded-lg hover:bg-yellow-500",whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Guardar cambios de perfil",children:"Guardar Cambios"})})]}):(0,u.jsxs)(i.P.div,{className:"space-y-6",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[(0,u.jsxs)("div",{className:"p-4 rounded-lg bg-gray-50 border border-gray-300",children:[(0,u.jsx)("h3",{className:"text-lg font-medium mb-4 text-gray-900",children:"Informaci\xf3n Personal"}),(0,u.jsxs)("p",{className:"text-gray-700",children:[(0,u.jsx)("strong",{children:"Nombre:"})," ",a.name||"No especificado"]}),(0,u.jsxs)("p",{className:"text-gray-700",children:[(0,u.jsx)("strong",{children:"Tel\xe9fono:"})," ",a.phone||"No especificado"]})]}),(0,u.jsxs)("div",{className:"p-4 rounded-lg bg-gray-50 border border-gray-300",children:[(0,u.jsx)("h3",{className:"text-lg font-medium mb-4 text-gray-900",children:"Direcci\xf3n"}),(0,u.jsxs)("p",{className:"text-gray-700",children:[(0,u.jsx)("strong",{children:"Direcci\xf3n:"})," ",a.street||"No especificado"]}),(0,u.jsxs)("p",{className:"text-gray-700",children:[(0,u.jsx)("strong",{children:"Ciudad:"})," ",a.city||"No especificado"]}),(0,u.jsxs)("p",{className:"text-gray-700",children:[(0,u.jsx)("strong",{children:"C\xf3digo postal:"})," ",a.postalCode||"No especificado"]}),(0,u.jsxs)("p",{className:"text-gray-700",children:[(0,u.jsx)("strong",{children:"Pa\xeds:"})," ",a.country||"No especificado"]})]})]})})]})},p=e=>{let{formData:a}=e;const r=["name","phone","street","city","postalCode","country"],t=r.filter((e=>a[e])).length/r.length*100;return(0,u.jsxs)("div",{className:"mb-6",children:[(0,u.jsxs)("p",{className:"text-sm font-medium text-gray-700",children:["Completitud del Perfil: ",Math.round(t),"%"]}),(0,u.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,u.jsx)(i.P.div,{className:"bg-yellow-400 h-2.5 rounded-full",initial:{width:0},animate:{width:`${t}%`},transition:{duration:.5}})})]})},h=()=>{const{user:e,isLoading:a,updateUserProfile:r}=(0,o.A)(),h=(0,s.Zp)(),[y,f]=(0,t.useState)((()=>{const e=localStorage.getItem("profileDraft");return e?JSON.parse(e):{name:"",phone:"",street:"",city:"",postalCode:"",country:"",avatar:""}})),[b,j]=(0,t.useState)({}),[v,N]=(0,t.useState)(!1),[C,w]=(0,t.useState)(!1);(0,t.useEffect)((()=>{if(e){var a,r,t,o;const i={name:e.name||"",phone:e.phone||"",street:(null===(a=e.address)||void 0===a?void 0:a.street)||"",city:(null===(r=e.address)||void 0===r?void 0:r.city)||"",postalCode:(null===(t=e.address)||void 0===t?void 0:t.postalCode)||"",country:(null===(o=e.address)||void 0===o?void 0:o.country)||"",avatar:e.avatar||""};f((e=>({...e,...i})))}}),[e]),(0,t.useEffect)((()=>{localStorage.setItem("profileDraft",JSON.stringify(y))}),[y]);const E=()=>N(!v);return a?(0,u.jsx)(n.A,{children:(0,u.jsx)(d.A,{})}):e?(0,u.jsx)(n.A,{children:(0,u.jsxs)(i.P.div,{className:"container mx-auto px-4 py-8 max-w-6xl min-h-screen bg-gray-100 text-gray-900",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[(0,u.jsx)("h1",{className:"text-4xl font-bold text-yellow-400 mb-8",children:"Mi Perfil - Home Control"}),(0,u.jsx)(p,{formData:y}),(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,u.jsx)(g,{user:e,onAvatarChange:(e,a)=>{f((e=>({...e,avatar:a}))),localStorage.setItem("profileDraft",JSON.stringify({...y,avatar:a}))},isEditing:v,toggleEdit:E}),(0,u.jsx)(x,{formData:y,setFormData:f,user:e,onSubmit:async e=>{if(e.preventDefault(),!((e,a)=>{const r={...b};return"name"!==e||a?"name"===e&&delete r.name:r.name="El nombre es obligatorio","phone"===e&&a&&!/^[0-9]{10}$/.test(a)?r.phone="Tel\xe9fono debe tener 10 d\xedgitos":"phone"===e&&delete r.phone,"postalCode"===e&&a&&!/^[0-9]{5}$/.test(a)?r.postalCode="C\xf3digo postal debe tener 5 d\xedgitos":"postalCode"===e&&delete r.postalCode,j(r),0===Object.keys(r).length})("name",y.name))return;const a={name:y.name,phone:y.phone,address:{street:y.street,city:y.city,postalCode:y.postalCode,country:y.country},avatar:y.avatar,profileIncomplete:!1};try{await r(a),w(!0),setTimeout((()=>{w(!1),N(!1),localStorage.removeItem("profileDraft"),h("/user/dashboard")}),1500)}catch(t){c.oR.error("Error al actualizar el perfil")}},errors:b,isEditing:v,toggleEdit:E,onDraftSave:e=>localStorage.setItem("profileDraft",JSON.stringify(e))})]}),(0,u.jsx)("button",{onClick:async()=>{try{if("granted"===await Notification.requestPermission()){const e=(0,m.dG)(),a=await(0,m.gf)(e,{vapidKey:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyDvVBx0r8MxX6xNe-dHdsvPdzOaORcuEk0",REACT_APP_FIREBASE_APP_ID:"1:860531471097:web:ed0f6c8638e36226092828",REACT_APP_FIREBASE_AUTH_DOMAIN:"homecontrol-dac34.firebaseapp.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"860531471097",REACT_APP_FIREBASE_PROJECT_ID:"homecontrol-dac34",REACT_APP_FIREBASE_STORAGE_BUCKET:"homecontrol-dac34.firebasestorage.app",REACT_APP_STRIPE_PUBLIC_KEY:"pk_test_51ROl5WRCz11UNurnDiqgkjLo3hOmSGZeRrEOvqOBtxK68hw3VolJZaIIvXSfKYBS3quOZ6wM3jOBE5GkqVY8pp0800vZNyTIAF"}.REACT_APP_FCM_VAPID_KEY});await r({fcmToken:a}),c.oR.success("Notificaciones habilitadas")}else c.oR.error("Permiso de notificaciones denegado")}catch(e){c.oR.error("Error al habilitar notificaciones")}},className:"mt-6 px-4 py-2 bg-yellow-400 text-gray-900 font-medium rounded-lg hover:bg-yellow-500","aria-label":"Habilitar notificaciones push",children:e.fcmToken?"Notificaciones habilitadas":"Habilitar Notificaciones"}),(0,u.jsx)(l.N,{children:C&&(0,u.jsxs)(i.P.div,{className:"fixed top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},role:"alert","aria-label":"Perfil actualizado correctamente",children:[(0,u.jsx)("svg",{className:"w-6 h-6 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"Perfil actualizado"]})})]})}):(0,u.jsx)(s.C5,{to:"/login",replace:!0})}},4932:(e,a,r)=>{r.d(a,{A:()=>i});r(9950);var t=r(3816),o=r(4414);const i=()=>{const e={animate:{rotate:360,transition:{repeat:1/0,duration:1,ease:"linear"}}};return(0,o.jsx)("div",{className:"flex items-center justify-center h-screen bg-background dark:bg-gray-900","aria-label":"Cargando",children:(0,o.jsx)(t.P.div,{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full",variants:e,animate:"animate",role:"status","aria-live":"polite"})})}}}]);